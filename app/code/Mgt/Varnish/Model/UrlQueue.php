<?php
 namespace Mgt\Varnish\Model; use Zend\Uri\Uri; class UrlQueue extends \Magento\Framework\Model\AbstractModel { const PRIORITY_HIGH = 1000; const PRIORITY_MEDIUM = 500; const PRIORITY_LOW = 100; protected $storeManager; protected $license; protected $licenseCache = []; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Mgt\Varnish\Model\ResourceModel\UrlQueue $resource, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\License $license) { goto B83d5; B83d5: parent::__construct($context, $registry, $resource); goto Fd0d6; b8326: $this->license = $license; goto D9dd7; Fd0d6: $this->storeManager = $storeManager; goto b8326; D9dd7: } protected function _construct() { $this->_init("\x4d\147\164\x5c\x56\141\162\156\x69\163\x68\x5c\x4d\x6f\144\145\x6c\134\x52\x65\163\157\x75\162\x63\x65\x4d\157\x64\145\154\x5c\x55\162\154\121\165\145\165\x65"); } public function getId() { return parent::getData("\165\x72\154\x5f\x69\x64"); } public function addToQueue(array $urls) { goto a1381; Ee287: $resource->addToQueue($urls); goto debff; b4d52: if (!$urls) { goto e2334; } goto E3036; a1381: $urls = $this->filterUrls($urls); goto b4d52; E3036: $resource = $this->_getResource(); goto Ee287; debff: e2334: goto a46f5; a46f5: } protected function filterUrls(array $urls) { goto B0775; D692e: de89b: goto Ebf98; B0775: $filteredUrls = []; goto e5fe0; e5fe0: foreach ($urls as $url) { goto cdc22; cdc22: $storeId = (int) $url["\x73\164\157\x72\145\x5f\x69\144"]; goto fa513; fa513: $url["\x70\x61\x74\x68"] = ltrim($url["\x70\x61\164\150"], "\x2f"); goto ef6f9; ef6f9: $canAddUrlToQueue = $this->canAddUrlToQueue($storeId); goto D6791; D6791: if (!(true === $canAddUrlToQueue)) { goto B8552; } goto C08ee; C08ee: $filteredUrls[] = $url; goto Bebf6; Ada75: cfbfc: goto f91ef; Bebf6: B8552: goto Ada75; f91ef: } goto D692e; Ebf98: return $filteredUrls; goto ec2fb; ec2fb: } protected function canAddUrlToQueue($storeId) { goto fa620; Aa8c1: Cac3b: goto B1195; B1195: goto fac29; goto Bc26d; F1cf5: $host = $uri->getHost(); goto Fd8e2; A0f3b: $this->licenseCache[$storeId] = $hasLicense; goto a9fcf; e14ab: $uri = new Uri($store->getBaseUrl()); goto F1cf5; a9fcf: if (true === $hasLicense) { goto D7d00; } goto e0d9a; c1c75: fac29: goto D6c03; C4ebc: $store = $this->storeManager->getStore($storeId); goto e14ab; fa620: if (isset($this->licenseCache[$storeId])) { goto A9c86; } goto C4ebc; aeec0: $canAddUrlToQueue = $this->licenseCache[$storeId]; goto Bae6d; Fd8e2: $hasLicense = $this->license->hasLicense($host); goto A0f3b; b9fae: return true; goto Aa8c1; Bc26d: A9c86: goto aeec0; e0d9a: return false; goto E0eb1; E0eb1: goto Cac3b; goto afc84; Bae6d: return $canAddUrlToQueue; goto c1c75; afc84: D7d00: goto b9fae; D6c03: } }
